version: '3'

tasks:
  install:
    desc: Install dependencies
    cmds:
      - pnpm install

  dev:
    desc: Start development server
    cmds:
      - pnpm run dev
    sources:
      - src/**/*
      - examples/**/*
      - playground/**/*
      - package.json
    generates:
      - dist/

  build:
    desc: Build for production
    cmds:
      - pnpm run build
    sources:
      - src/**/*
      - package.json
    generates:
      - dist/

  preview:
    desc: Preview production build
    cmds:
      - pnpm run preview
    deps: [build]

  lint:
    desc: Run ESLint
    cmds:
      - pnpm run lint

  lint:fix:
    desc: Fix ESLint issues
    cmds:
      - pnpm run lint --fix

  format:
    desc: Format code with Prettier
    cmds:
      - pnpm run format

  test:
    desc: Run tests
    cmds:
      - pnpm test

  test:watch:
    desc: Run tests in watch mode
    cmds:
      - pnpm test --watch

  clean:
    desc: Clean build artifacts
    cmds:
      - rm -rf dist/
      - rm -rf node_modules/
      - rm -rf .vite/
      - rm -rf docs/.vitepress/cache/

  docs:dev:
    desc: Start documentation development server
    cmds:
      - pnpm run docs:dev

  docs:build:
    desc: Build documentation
    cmds:
      - pnpm run docs:build

  docs:preview:
    desc: Preview documentation build
    cmds:
      - pnpm run docs:preview

  setup:
    desc: Initial project setup
    cmds:
      - pnpm install
      - pnpm add -D @types/node

  gitpod:setup:
    desc: Setup for Gitpod environment
    cmds:
      - echo "🚀 Setting up Gitpod environment..."
      - pnpm install --frozen-lockfile
      - echo "✅ Dependencies installed"
      - pnpm run dev --host 0.0.0.0

  gitpod:dev:
    desc: Start Gitpod development server
    cmds:
      - echo "🚀 Starting Vite server for Gitpod..."
      - pnpm run dev --host 0.0.0.0 --port 5173

  gitpod:prebuild:
    desc: Prebuild setup for faster Gitpod launches
    cmds:
      - echo "🔄 Running prebuild setup..."
      - pnpm install --frozen-lockfile
      - pnpm run build
      - echo "✅ Prebuild complete!"

  # Development workflow tasks
  start:
    desc: Start development environment (install + dev)
    deps: [install]
    cmds:
      - pnpm run dev

  check:
    desc: Run all checks (lint + test)
    deps: [lint, test]

  full-build:
    desc: Full build process (lint + test + build)
    deps: [lint, test, build]

  # Utility tasks
  update-deps:
    desc: Update dependencies
    cmds:
      - pnpm update

  audit:
    desc: Audit dependencies
    cmds:
      - pnpm audit

  type-check:
    desc: Run TypeScript type checking
    cmds:
      - pnpm tsc --noEmit

  # Examples
  examples:dev:
    desc: Start examples development server
    cmds:
      - cd examples && pnpm run dev

  playground:dev:
    desc: Start playground development server
    cmds:
      - cd playground && pnpm run dev

  # Docker tasks
  docker:start:
    desc: Start Docker development environment
    cmds:
      - echo "🚀 Starting Docker development environment..."
      - docker-compose up -d
      - echo "✅ Development server should be available at http://localhost:5173"
      - echo "💡 Use 'task docker:logs' to view logs or 'task docker:stop' to stop"
    env:
      DOCKER_BUILDKIT: 1
      COMPOSE_DOCKER_CLI_BUILD: 1

  docker:stop:
    desc: Stop Docker development environment
    cmds:
      - echo "⏹️ Stopping Docker development environment..."
      - docker-compose down
      - echo "✅ Docker environment stopped"

  docker:restart:
    desc: Restart Docker development environment
    cmds:
      - echo "🔄 Restarting Docker development environment..."
      - docker-compose restart
      - echo "✅ Docker environment restarted"

  docker:rebuild:
    desc: Rebuild and restart Docker containers
    cmds:
      - echo "🔨 Rebuilding Docker containers..."
      - docker-compose down
      - docker-compose build --no-cache
      - docker-compose up -d
      - echo "✅ Docker rebuild complete!"
    env:
      DOCKER_BUILDKIT: 1
      COMPOSE_DOCKER_CLI_BUILD: 1

  docker:logs:
    desc: Show Docker container logs
    cmds:
      - echo "📋 Showing Docker logs (Press Ctrl+C to exit)..."
      - docker-compose logs -f

  docker:shell:
    desc: Open shell in Docker container
    cmds:
      - echo "🐚 Opening shell in Docker container..."
      - docker-compose exec vite sh

  docker:clean:
    desc: Clean Docker resources and rebuild
    cmds:
      - echo "🧹 Cleaning Docker resources..."
      - docker-compose down -v
      - docker system prune -f
      - docker-compose build
      - echo "✅ Docker cleanup complete!"
    env:
      DOCKER_BUILDKIT: 1
      COMPOSE_DOCKER_CLI_BUILD: 1

  docker:build:
    desc: Build Docker containers only
    cmds:
      - echo "🔨 Building Docker containers..."
      - docker-compose build
      - echo "✅ Docker build complete!"
    env:
      DOCKER_BUILDKIT: 1
      COMPOSE_DOCKER_CLI_BUILD: 1
